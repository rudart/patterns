# Наблюдатель

Определение из Википедии:

> Паттерн **Наблюдатель** создает механизм у класса, который позволяет получать экземпляру объекта этого класса оповещения от других объектов об изменении их состояния, тем самым наблюдая за ними.

Если сказать простыми словами, то при реализации паттерна **"Наблюдатель"** у нас есть объект (его называют *издателем* или *субъектом*), за изменением состояния которого может наблюдать переменное число других объектов (их называют *наблюдателями* или *подписчиками*).

Можно привести массу примеров из реальной жизни, где используется паттерн **"Наблюдатель"**. Думаю, что все знают, как обрабатывать различные события текстового поля. Нажатие клавиши, отпускание клавиши и так далее. В этом случае - текстовое поле будет *субъектом*, а обработчики, которые реагируют на различные события - *наблюдателями*.

## Опиание приложения

Разберем для ясности простой пример использования паттерна "Наблюдатель". Сделаем приложение, в котором будет **издатель**, выпускающий газету, и **читатели**. Когда издатель выпустит новый номер газеты, то все читатели должны будут его получить. Если читатель отпишется от получения, то газеты ему доставляться не будут.

![](http://storage7.static.itmages.com/i/14/1222/h_1419279095_9090167_1bfbe5af01.png)

У **издателя** будет приватное свойство `_pubCtrl` типа `StreamController`. Публичное свойство `onPub` класса `Stream`, через которое будет осуществляться подписка. 

Здесь я хочу сделать небольшое отступление. В Dart есть несколько путей для реализации паттерна **Наблюдатель**. Например, его можно реализовать с помощью пакета [observable](https://pub.dartlang.org/packages/observe), либо с помощью потоков. В нашем примере мы рассмотрим реализацию с помощью потоков.

Также у **издателя** будет метод `publish()`, принимающий на вход объект газеты - этот метод будет отвечать за *выпуск* газеты. 

У **газеты** мы будем знать только ее номер (`number`) и заголовок на первой полосе (`firstLine`).

![](http://storage9.static.itmages.com/i/14/1222/h_1419280210_8580232_b57f643d87.png)

У **читателя** будет имя (`name`) и метод `read()`, принимающий на вход газету.

![](http://storage6.static.itmages.com/i/14/1222/h_1419283169_7989755_bd05e316c7.png)

## Начнем писать код

Первым делом создадим `pubspec.yaml` в котором укажем имя нашего приложения:

```yaml
name: paper
```

Создадим папку `bin`, а в ней файл `main.dart` с пустой функцией `main()`:

```dart
main() {
	
}
```

Создадим папку `lib`, в которой бдует находиться библиотека нашего приложения. В файле `lib/paper.dart` объями библиотеку `paper`:

```dart
library paper;
```

### Класс газеты

Создадим папку `src` в директории `lib`. В ней (`lib/src`) сделаем файл `paper.dart` с объявлением класса газеты:

```dart
part of paper;

class Paper {

  int number;
  String firstLine;

  Paper(this.number, this.firstLine);

}
```

В первой строке указано, что данный файл (`lib/src/paper.dart`) является частью библиотеки `paper`. Затем мы объявили класс, два свойства - `number` (номер газеты) и `firstLine` (заголовок на первой строке). Также сделали конструктор, через который можно будет установить значения этим свойствам при создании газеты.

После этого нужно подключить файл `lib/src/paper.dart` к библиотеке. Сделать это можно с помощью ключевого слова `part` в файле, где объявлена библиотека (`lib/paper.dart`):

```dart
library paper;

part "src/paper.dart";
```
> **Примечание** 
>
> Дальше мы создадим еще файлы для нашей библиотеки. Их нужно будет так же, как и сейчас, подключить к библиотеке.

### Класс читателя

Создадим файл `lib/src/reader.dart` со следующим содержимым:

```dart
part of paper;

class Reader {

  String name;

  Reader(this.name);

  void read(Paper paper) {
    print("Я $name. Получил газету #${paper.number} с заголовком \"${paper.firstLine}\"");
  }

}
```

В этом файле мы объявили класс `Reader`, указали у него свойство `name` и конструктор, через который можно будет установить значение этому свойству. Объявили функцию `read(Paper paper)`, принимающую на вход объект класса `Paper`. В ней читатель просто говорит, кто он такой и что прочитал.

